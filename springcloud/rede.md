#spring cloud
现今互联网的开发，高并发、大数据、快响应已经是普遍的要求。为了支撑这样的需求，互联网系统也开始引入分布式的开发。spring推出了一套组件
就是spring could。spring cloud是将目前各家公司已经开发好的、经过实践考验的，较为成熟的技术组合起来，通过spring boot风格进行封装
从而屏蔽掉复杂的配置和实现原理，为开发者提供了一套简单易懂、易部署和维护的分布式系统开发包。

首先，Spring cloud是一套组件，可以细分为多种组件，如服务发现、配置中心、消息总线、负载均衡、断路器和数据监控等。

###服务治理和发现
在Spring Cloud中主要是使用Netflix Eureka作为服务治理的，Spring Cloud对其进行了一次封装。使得开发者可以使用spring boot的风格使用它。
通过服务注册将单个微服务节点注册给服务治理中心，这样服务治理中心就可以治理单个微服务节点。服务注册则是微服务节点可以对服务治理中心发送消息，使得服
务治理中心可以将新的微服务节点纳入管理。

###客户端负载均衡
在微服务的开发中，会将一个大的系统拆分为多个微服务系统，而各个微服务系统之间需要相互协作。每个微服务可能存在多个节点，当一个微服务调用(服务消费者)
另外一个微服务(服务提供者)时，服务提供者需要负载均衡算法提供一个节点进行响应。spring cloud提供了Ribbon来实现。

###声明服务调用
对于REST风格的调用，如果使用restTemplate会比较繁琐哦，可读性不高。为了简化多次调用的复杂度，spring cloud提供了接口式的声明服务调用编程，他就
是Feign。通过它请求其他微服务时，就如同调度本地服务的Java接口一样，从而简化开发者的编程，提供代码可读性。

###断路器
在分布式中，因为存在网络延迟或故障，所以一些服务调用无法及时响应。如果此时服务消费者孩子啊大量的调用这些网络延迟或者故障的服务调用者，那么很快消费者
也会因为大量的等待，造成挤压，最终导致其自身出现服务瘫痪。Spring Cloud引入Netflix的开源框架Hystrix来处理该问题。当服务提供者响应延迟或故障时，
就会使得服务消费者长期得不到响应，Hystrix就会对这些延迟或者故障的服务进行处理。这就如同电路负荷过大，保险丝会烧毁从而保障用电安全一样，于是形象的
称为断路器。这样当服务消费者长期得不到服务提供者的响应时，就可以进行降级、服务断路、线程和信号隔离、请求缓存或者合并处理等等。

###API网关
在spring Cloud中API网关是zuul。对于网关而言，存在两个作用：第一个作用是将请求的地址映射为真实服务器的地址额，例如用户请求http://localhost/
user/1去获取用户id为1的信息，而真实的服务是http://localhost:8001/user/1和http://localhost:8002/user/1都可以获取用户下信息，这时就可以
通过网关使得localhost/user映射为对应真实服务器的地址。显然这个作用就起到了路由转发的作用，从而降低单个节点的负载。从这点说，我们把它称为服务端
负载均衡。从高可用的角度来说，则一个请求地址可以映射到堕胎服务上，如果单点出现故障，则其他节点也能提供服务，这样就是一个高可用的服务了。Zuul网关的
第二个作用是过滤服务，在互联网中，服务器可能面临各种工具，Zuul提供了过滤器，通过它过滤那些恶意或者无效的请求，把他们排除在服务网站之外，来降低网站
服务的风险。

分布式还有很多重要的技术需要讨论，带以后补充
--
###分布式事务
###分布式数据一致性
###消息总线

##服务治理与发现
参见GovernanceDiscovery-Eureka包

##微服务之间的调用
对于业务，往往需要各个微服务之间相互地协助才能完成。其中使用REST风格相互调用。Spring Cloud提供了Ribbon和Feign组件来帮助我们完成这些功能。通过
它们，各个微服务之间就能相互调用，并且默认实现了负载均衡。

###Feign声明式调用
上节使用RestTemplate但有时某个微服务REST风格请求需要多次调用。如果多次调用，使用RestTemplate并非那么友好。因为除了要编写URL，还要注意参数的
组装和结果的返回等操作。为了克服这些不友好，除了Ribbon外，Spring Cloud还提供了声明式调用组件——Feign。  
Feign是基于接口的编程方式，开发者只需要声明接口和配置注解，在调度接口方法时，Spring Cloud就根据配置来调度对应的REST风格的请求，从其他微服务系
统中获取数据。  
@EnableFeignClients注解用来启用Feign，并制定对应的包扫描，用来加入接口声明。仅仅是一个接口声明，不需要实现类。  

@FeignClient("USER") 代表这是一个Feign客户端，配置的"USER"指向用户微服务，这样Feign就会知道向用户微服务请求，并实现负载均衡。    
@GetMapping 代表启用HTTP的GET请求用户微服务  
@PathVariable 从URL中获取参数，这是Spring MVC的规则

之所以使用Spring MVC的规则，则是为了降低读者的学习成本。  

在ProductController中加入UserService接口对象的注入，并调度用户微服务的REST端点。


##断路器——Hystrix
在互联网中，可能存在某一个微服务的某个时刻压力变大导致服务缓慢，甚至出现故障，导致服务不能响应。  
现假设用户微服务请求中出现压力过大，服务响应速度变缓，进入瘫痪状态，而此时产品微服务还是正常响应。  
但是如果出现产品微服务大量调用用户微服务，就会出现大量的等待，如果还是持续进行调用，则会造成大量请求的积压，导致产品微服务最终也不可用。  
可见在分布式中，如果一个服务不可用，其自身不可用之后，又可以蔓延到其他与之相关的微服务上，这样就会导致更多微服务不可用，最终导致分布式服务瘫痪。  
为了防止这样的蔓延，微服务提出了断路器的概念。断路器如同电路中的保险丝，如果电器耗电量大，导致电流过大，那么保险丝就会熔断，从而保障用电安全。同样
在微服务系统之间大量调用可能导致服务消费者自身出现瘫痪的情况下，断路器就会将这些挤压的大量请求“熔断”，来保障其自身服务可用，而不会蔓延到其他微服务
系统上。这样，可以保持各个微服务持续可用。

####降级服务
处理限制请求的方式的策略很多，如限流、缓存等。在此介绍最为常见的降级服务。降级服务就是当请求其他微服务出现超时(timeout)或者发生故障时，就会使用自
身服务其他的方法响应。在Spring Cloud中断路器是由NetFlix的Hystrix实现的，它默认监控微服务之间的调用超时时间为2000ms(2s)，如果超时，他会根据
你的配置使用其他方法进行响应。

@EnableCircuitBreaker 告诉Spring启动断路器

@HystrixCommand(fallbackMethod = "error",commandProperties = {@HystrixProperty(
            name = "execution.isolation.thread.timeoutInMilliseconds",value = "3000")})  
设置超时处理方法和设置超时时间
   
            

####Ribbon客户端负载均衡